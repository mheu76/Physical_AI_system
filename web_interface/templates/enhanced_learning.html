
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ ÎåÄÌôîÌòï ÎèôÏûëÌïôÏäµ ÏãúÏä§ÌÖú</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }
        
        .header {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            color: #4a5568;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e53e3e;
            transition: background 0.3s;
        }
        
        .status-dot.connected {
            background: #38a169;
        }
        
        .chat-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .chat-header {
            padding: 15px 20px;
            background: #4299e1;
            color: white;
            font-weight: bold;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f7fafc;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .message.user {
            background: #4299e1;
            color: white;
            margin-left: auto;
        }
        
        .message.ai {
            background: #48bb78;
            color: white;
        }
        
        .message.system {
            background: #ed8936;
            color: white;
            text-align: center;
            max-width: 100%;
        }
        
        .chat-input {
            padding: 20px;
            background: white;
            border-top: 1px solid #e2e8f0;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #4299e1;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4299e1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3182ce;
        }
        
        .btn-voice {
            background: #e53e3e;
            color: white;
        }
        
        .btn-voice.listening {
            background: #38a169;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .simulation-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .simulation-header {
            padding: 15px 20px;
            background: #48bb78;
            color: white;
            font-weight: bold;
        }
        
        .simulation-canvas {
            flex: 1;
            position: relative;
            background: #f0f8ff;
            overflow: hidden;
        }
        
        .robot {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #4299e1;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(66, 153, 225, 0.4);
        }
        
        .target {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #48bb78;
            border-radius: 50%;
            opacity: 0.7;
        }
        
        .trajectory-point {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(66, 153, 225, 0.6);
            border-radius: 50%;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .panel-section {
            margin-bottom: 25px;
        }
        
        .panel-title {
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .skill-item {
            margin-bottom: 15px;
        }
        
        .skill-name {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #48bb78);
            transition: width 0.5s ease;
        }
        
        .feedback-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .btn-feedback {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-positive {
            background: #48bb78;
            color: white;
        }
        
        .btn-negative {
            background: #e53e3e;
            color: white;
        }
        
        .btn-corrective {
            background: #ed8936;
            color: white;
        }
        
        .btn-guidance {
            background: #805ad5;
            color: white;
        }
        
        .system-info {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
        
        .learning-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #4299e1;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="title">üéØ ÎåÄÌôîÌòï ÎèôÏûëÌïôÏäµ ÏãúÏä§ÌÖú</div>
            <div class="status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Ïó∞Í≤∞ Ï§ë...</span>
            </div>
        </div>
        
        <!-- Chat Panel -->
        <div class="chat-panel">
            <div class="chat-header">üí¨ AIÏôÄ ÎåÄÌôî</div>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="chat-input">
                <div class="input-group">
                    <input type="text" class="input-field" id="messageInput" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
                    <button class="btn btn-voice" id="voiceBtn">üé§</button>
                    <button class="btn btn-primary" id="sendBtn">Ï†ÑÏÜ°</button>
                </div>
            </div>
        </div>
        
        <!-- Simulation Panel -->
        <div class="simulation-panel">
            <div class="simulation-header">üëÅÔ∏è Ïã§ÏãúÍ∞Ñ ÏãúÎÆ¨Î†àÏù¥ÏÖò</div>
            <div class="simulation-canvas" id="simulationCanvas">
                <div class="robot" id="robot" style="left: 380px; top: 280px;">ü§ñ</div>
            </div>
        </div>
        
        <!-- Control Panel -->
        <div class="control-panel">
            <!-- Learning Stats -->
            <div class="panel-section">
                <div class="panel-title">üìä ÌïôÏäµ ÌÜµÍ≥Ñ</div>
                <div class="learning-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalInteractions">0</div>
                        <div class="stat-label">Ï¥ù ÏÉÅÌò∏ÏûëÏö©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">ÏÑ±Í≥µÎ•†</div>
                    </div>
                </div>
            </div>
            
            <!-- Skill Progress -->
            <div class="panel-section">
                <div class="panel-title">üéØ Ïä§ÌÇ¨ ÏßÑÌñâÎèÑ</div>
                <div id="skillProgress">
                    <!-- Skills will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Quick Feedback -->
            <div class="panel-section">
                <div class="panel-title">‚ö° Îπ†Î•∏ ÌîºÎìúÎ∞±</div>
                <div class="feedback-buttons">
                    <button class="btn-feedback btn-positive" onclick="sendFeedback('positive', 'Ï¢ãÏäµÎãàÎã§!')">üëç Ï¢ãÏùå</button>
                    <button class="btn-feedback btn-negative" onclick="sendFeedback('negative', 'Îã§Ïãú ÏãúÎèÑ')">üëé Í∞úÏÑ† ÌïÑÏöî</button>
                    <button class="btn-feedback btn-corrective" onclick="sendFeedback('corrective', 'ÏàòÏ†ï ÌïÑÏöî')">üîß ÏàòÏ†ï</button>
                    <button class="btn-feedback btn-guidance" onclick="sendFeedback('guidance', 'ÏïàÎÇ¥ ÌïÑÏöî')">üìñ ÏïàÎÇ¥</button>
                </div>
            </div>
            
            <!-- System Control -->
            <div class="panel-section">
                <div class="panel-title">‚öôÔ∏è ÏãúÏä§ÌÖú Ï†úÏñ¥</div>
                <button class="btn btn-primary" onclick="initializeSystem()" style="width: 100%; margin-bottom: 10px;">ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî</button>
                <button class="btn btn-primary" onclick="startLearningSession()" style="width: 100%;">ÌïôÏäµ ÏÑ∏ÏÖò ÏãúÏûë</button>
            </div>
            
            <!-- System Info -->
            <div class="panel-section">
                <div class="panel-title">‚ÑπÔ∏è ÏãúÏä§ÌÖú Ï†ïÎ≥¥</div>
                <div class="system-info" id="systemInfo">
                    ÏãúÏä§ÌÖú ÏÉÅÌÉú: ÎåÄÍ∏∞ Ï§ë<br>
                    ÌôúÏÑ± ÏÑ∏ÏÖò: 0Í∞ú<br>
                    ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: -
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Socket.IO Ïó∞Í≤∞
        const socket = io();
        
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let isListening = false;
        let userId = null;
        let currentSession = null;
        let totalInteractions = 0;
        let successfulInteractions = 0;
        
        // DOM ÏöîÏÜå
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const voiceBtn = document.getElementById('voiceBtn');
        const sendBtn = document.getElementById('sendBtn');
        const robot = document.getElementById('robot');
        const simulationCanvas = document.getElementById('simulationCanvas');
        const skillProgressContainer = document.getElementById('skillProgress');
        const systemInfo = document.getElementById('systemInfo');
        
        // Socket Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
        socket.on('connected', (data) => {
            userId = data.user_id;
            statusDot.classList.add('connected');
            statusText.textContent = 'Ïó∞Í≤∞Îê®';
            addMessage('system', 'ÏãúÏä§ÌÖúÏóê Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§.');
            updateSystemInfo(data);
        });
        
        socket.on('ai_response', (data) => {
            addMessage('ai', data.response);
            totalInteractions++;
            updateStats();
        });
        
        socket.on('robot_position_update', (data) => {
            const pos = data.position;
            robot.style.left = pos.x - 20 + 'px';
            robot.style.top = pos.y - 20 + 'px';
            
            // Í∂§Ï†Å Ï†ê Ï∂îÍ∞Ä
            addTrajectoryPoint(pos.x, pos.y);
        });
        
        socket.on('robot_action_complete', (data) => {
            addMessage('system', `ÎèôÏûë ÏôÑÎ£å: ${data.action}`);
            successfulInteractions++;
            updateStats();
        });
        
        socket.on('skill_progress_update', (data) => {
            updateSkillProgress(data.skills);
        });
        
        socket.on('learning_adjusted', (data) => {
            addMessage('system', `ÌïôÏäµ Ï°∞Ï†ï: ${data.skill} - ${data.parameter} (${data.reason})`);
        });
        
        socket.on('system_initialized', (data) => {
            addMessage('system', '‚úÖ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
            statusText.textContent = 'ÏãúÏä§ÌÖú Ï§ÄÎπÑÎê®';
        });
        
        socket.on('system_error', (data) => {
            addMessage('system', `‚ùå Ïò§Î•ò: ${data.error}`);
        });
        
        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        sendBtn.addEventListener('click', sendMessage);
        voiceBtn.addEventListener('click', toggleVoiceInput);
        
        // ÏãúÎÆ¨Î†àÏù¥ÏÖò Ï∫îÎ≤ÑÏä§ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        simulationCanvas.addEventListener('click', (e) => {
            const rect = simulationCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Î°úÎ¥á Ïù¥Îèô ÏöîÏ≤≠
            fetch('/api/robot/move', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({x: x, y: y})
            });
            
            addMessage('user', `ÏúÑÏπò (${Math.round(x)}, ${Math.round(y)})Î°ú Ïù¥Îèô ÏöîÏ≤≠`);
        });
        
        // Ìï®ÏàòÎì§
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            addMessage('user', message);
            messageInput.value = '';
            
            // ÏÑúÎ≤ÑÏóê Î©îÏãúÏßÄ Ï†ÑÏÜ°
            fetch('/api/chat/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    message: message,
                    type: 'text'
                })
            });
        }
        
        function toggleVoiceInput() {
            if (!isListening) {
                startVoiceRecognition();
            } else {
                stopVoiceRecognition();
            }
        }
        
        function startVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                addMessage('system', 'ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Î∏åÎùºÏö∞Ï†ÄÏûÖÎãàÎã§.');
                return;
            }
            
            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onstart = () => {
                isListening = true;
                voiceBtn.classList.add('listening');
                voiceBtn.textContent = 'üõë';
                addMessage('system', 'ÏùåÏÑ± Ïù∏Ïãù ÏãúÏûë...');
            };
            
            recognition.onresult = (event) => {
                const result = event.results[0][0].transcript;
                messageInput.value = result;
                addMessage('user', `[ÏùåÏÑ±] ${result}`);
                
                // ÏûêÎèôÏúºÎ°ú Î©îÏãúÏßÄ Ï†ÑÏÜ°
                setTimeout(() => {
                    sendMessage();
                }, 500);
            };
            
            recognition.onerror = (event) => {
                addMessage('system', `ÏùåÏÑ± Ïù∏Ïãù Ïò§Î•ò: ${event.error}`);
                stopVoiceRecognition();
            };
            
            recognition.onend = () => {
                stopVoiceRecognition();
            };
            
            recognition.start();
        }
        
        function stopVoiceRecognition() {
            isListening = false;
            voiceBtn.classList.remove('listening');
            voiceBtn.textContent = 'üé§';
        }
        
        function sendFeedback(type, content) {
            fetch('/api/feedback/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    feedback_type: type,
                    content: content,
                    confidence: 1.0,
                    context: {
                        current_skill: 'basic_movement',
                        action: 'user_feedback'
                    }
                })
            });
            
            addMessage('user', `[ÌîºÎìúÎ∞±] ${content}`);
        }
        
        function initializeSystem() {
            fetch('/api/system/initialize', {method: 'POST'})
                .then(response => response.json())
                .then(data => {
                    addMessage('system', 'ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
                });
        }
        
        function startLearningSession() {
            const userName = prompt('ÏÇ¨Ïö©Ïûê Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', 'User');
            if (!userName) return;
            
            fetch('/api/learning/session/start', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    user_name: userName
                })
            })
            .then(response => response.json())
            .then(data => {
                currentSession = data.session_id;
                addMessage('system', `ÌïôÏäµ ÏÑ∏ÏÖò ÏãúÏûë: ${currentSession}`);
            });
        }
        
        function addMessage(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            messageDiv.innerHTML = `${content}<div style="font-size: 10px; opacity: 0.7; margin-top: 5px;">${timestamp}</div>`;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function addTrajectoryPoint(x, y) {
            const point = document.createElement('div');
            point.className = 'trajectory-point';
            point.style.left = x - 2 + 'px';
            point.style.top = y - 2 + 'px';
            
            simulationCanvas.appendChild(point);
            
            // Ïò§ÎûòÎêú Ï†êÎì§ Ï†úÍ±∞ (ÏµúÎåÄ 50Í∞ú)
            const points = simulationCanvas.querySelectorAll('.trajectory-point');
            if (points.length > 50) {
                points[0].remove();
            }
        }
        
        function updateSkillProgress(skills) {
            skillProgressContainer.innerHTML = '';
            
            for (const [skillName, progress] of Object.entries(skills)) {
                const skillDiv = document.createElement('div');
                skillDiv.className = 'skill-item';
                
                const percentage = Math.round(progress * 100);
                const displayName = skillName.replace(/_/g, ' ').replace(/\w/g, l => l.toUpperCase());
                
                skillDiv.innerHTML = `
                    <div class="skill-name">${displayName}</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 2px;">${percentage}%</div>
                `;
                
                skillProgressContainer.appendChild(skillDiv);
            }
        }
        
        function updateStats() {
            document.getElementById('totalInteractions').textContent = totalInteractions;
            const successRate = totalInteractions > 0 ? Math.round((successfulInteractions / totalInteractions) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
        }
        
        function updateSystemInfo(data) {
            const info = `
                ÏãúÏä§ÌÖú ÏÉÅÌÉú: ${data.system_status ? 'Ï§ÄÎπÑÎê®' : 'Ï¥àÍ∏∞Ìôî Ï§ë'}<br>
                ÏÇ¨Ïö©Ïûê ID: ${userId ? userId.substring(0, 8) + '...' : '-'}<br>
                ÏÑ∏ÏÖò: ${currentSession || 'ÏóÜÏùå'}<br>
                ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleTimeString()}
            `;
            systemInfo.innerHTML = info;
        }
        
        // Ï¥àÍ∏∞Ìôî
        window.addEventListener('load', () => {
            // Í∏∞Î≥∏ Ïä§ÌÇ¨ ÏßÑÌñâÎèÑ ÌëúÏãú
            updateSkillProgress({
                'basic_movement': 0.92,
                'object_recognition': 0.72,
                'simple_grasp': 0.50,
                'precise_manipulation': 0.20
            });
            
            // ÏãúÏä§ÌÖú ÏÉÅÌÉú Ï£ºÍ∏∞Ï†Å ÏóÖÎç∞Ïù¥Ìä∏
            setInterval(() => {
                updateSystemInfo({system_status: statusDot.classList.contains('connected')});
            }, 5000);
        });
    </script>
</body>
</html>
    